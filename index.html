<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
      integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf"
      crossorigin="anonymous"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="Develop/style.css" />
    <title>Weather Dashboard</title>
  </head>
  <body>
    <header class="jumbotron">
      <h1 class="display-3">Weather Dashboard</h1>
    </header>
    </div>
    <div class="container">
      <div class="search-box">
        <form class=>
          <p>Search for a City:</p>
        </form>
        </div>
       <input id="searchValue" type="text" placeholder="City..."/>
       <button id="search" class="btn btn-primary">Search</button>
       <!-- Retrieved data will be dumped here -->
       <div class="container">
        <div class="row">
          <div id="currentWeather" class="col-md-8">
          </div>
      <div class="container">
        <h3>5-Day Forecast:</h3>
          <div id="daily-weather" class="row">
          </div>
       </div>
              </div>
      </div>
      </div>
     </div>
    <script type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">
      $(document).ready(function () {
        $("#search").on("click", function () {
          var searchValue = $("#searchValue").val();
          currentWeather(searchValue);
          console.log(searchValue);
          
          $.get("https://api.openweathermap.org/data/2.5/weather?q=London,uk&appid=988c3620d7b8b93676443618f9978507", function(data) {
          console.log(data);
});

    });
        // This is our API key. Add your own API key between the ""
        var APIKey = "988c3620d7b8b93676443618f9978507";
        // Here we are building the URL we need to query the database
        function currentWeather(city) {
          console.log(city)
          // We then created an AJAX call
          $.ajax({
            url:
              "https://api.openweathermap.org/data/2.5/weather?&units=imperial&q=" +
              city +
              "&appid=" +
              APIKey,
            method: "GET",
          }).then(function (response) {
            console.log(response);
            localStorage.setItem("history", JSON.stringify(city))
            var title = $("<h3>").addClass("card-title").text(city + " " + new Date().toLocaleDateString())
            var date = $("<h5>").addClass("card-title").text("")
            console.log(date) 
            var card = $("<div>").addClass("card")
            var temperature = $("<p>").addClass("card-text").text(response.main.temp + ' °F')
            var humidity = $("<p>").addClass("card-text").text(response.main.humidity + '%')
            var wind = $("<p>").addClass("card-text").text(response.wind.speed + ' MPH')
            var uvIndex = $("<p>").addClass("card-text").text(response.value)
            var cardBody = $("<div>").addClass("card-body")
            cardBody.append(title, 'Temperature:', temperature, 'Humidity:', humidity, 'Wind Speed:', wind)
            card.append(cardBody)
            $("#currentWeather").prepend(card)
            
            getForecast(city)
            getUvindex(response.coord.lat, response.coord.lon) 
                        
          }).catch(function (error){
            console.log(error)
          })
        }
  //       //**Display five day weather
  // function display5day(noonWeather) {
  //   console.log("5 day", noonWeather);
  //   const forecast = $(".forecast");
  //   forecast.empty();
  //   noonWeather.forEach((day) => {
  //     const div = $('<div class="oneDayForecast"/>');
  //     const iconUrl = `https://openweathermap.org/img/wn/${day.weather[0].icon}@2x.png`;
  //     div.append(`<h2>${new Date(day.dt_txt).toLocaleDateString()}</h2>`);
  //     div.append(`<h2>${new Date().toLocaleDateString
      // div.append(`<img src="${iconUrl}">`);
  //     div.append(`<div>Temp: ${day.main.temp}</div>`);
  //     div.append(`<div>Humidity: ${day.main.humidity}</div>`);
  //     forecast.append(div);
  //   });
  // }
  function getForecast(city) {
          console.log("forecast", city)
          $.ajax({
            url: `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${APIKey}&units=imperial`,
            method: "GET"
          }).then(function (response){
            console.log(response)
            for(var i = 0; i < response.list.length; i+=8) {
              var col = $("<div>").addClass("col-lg-2")
              var card = $("<div>").addClass("card")
                // var span = $('<span />').attr({'className':'folder_name' , 'text':'favre' });
              var cardBody = $("<div>").addClass("card-body")
              var title = $("<h3>").addClass("card-title").text(new Date(response.list[i].dt_txt).toLocaleDateString())
              // var locationIcon = document.querySelector('.weather-icon')
              // var {icon} = data.weather[0]
              // locationIcon.innerHTML = `<img src="icons/${icon}.png">`
              // var iconUrl = `https://openweathermap.org/img/wn/${day.weather[0].icon}@2x.png`
              // var iconUrl = `http://openweathermap.org/img/wn/10d@2x.png`
              // var icon = $(`<img src="${iconUrl}">`)
              var temp = $("<h5>").addClass("card-title").text(response.list[i].main.temp + ' °F')
              var humidity = $("<h5>").addClass("card-title").text(response.list[i].main.humidity + '%')
              col.append(card.append(cardBody.append(title, "Temp: ", temp, "Humidity: ", humidity)))
              $("#daily-weather").append(col)
            }
          }) 
        }
        function getUvindex(lat, lon) {
          $.ajax({
            url:
              `http://api.openweathermap.org/data/2.5/uvi?lat=${lat}&lon=${lon}&appid=${APIKey}`,
            method: "GET",
          }).then(function (response) {
            // getUvindex(response.coord.lat, response.coord.lon)
            console.log("uv response: ", response)
            var uvIndex = $("<p>").addClass("card-text").text(response.value)
            var cardBody = $("<div>").addClass("card-body")
            var card = $("<div>").addClass("card")
            $("#currentWeather").append(card)
            cardBody.append('UV Index:', uvIndex)
            card.append(cardBody)
          })
        }
       });

   </script>
    <!-- // Create CODE HERE to Log the queryURL xdonex
    // Create CODE HERE to log the resulting object
    // Create CODE HERE to calculate the temperature (converted from Kelvin)
    // Create CODE HERE to transfer content to HTML
    // Hint: To convert from Kelvin to Fahrenheit: F = (K - 273.15) * 1.80 + 32
    // Create CODE HERE to dump the temperature content into HTML -->
   <!-- //   add to search input results to search history
  //   localStorage.setItem("searchInfo", JSON.stringify(user));
    -->
    <!-- GIVEN a weather dashboard with form inputs
    WHEN I search for a city
    THEN I am presented with current and future conditions for that city and that city is added to the search history
    WHEN I view current weather conditions for that city
    THEN I am presented with the city name, the date, an icon representation of weather conditions, the temperature, the humidity, the wind speed, and the UV index
    WHEN I view the UV index
    THEN I am presented with a color that indicates whether the conditions are favorable, moderate, or severe
    WHEN I view future weather conditions for that city
    THEN I am presented with a 5-day forecast that displays the date, an icon representation of weather conditions, the temperature, and the humidity
    WHEN I click on a city in the search history
    THEN I am again presented with current and future conditions for that city
    WHEN I open the weather dashboard
    THEN I am presented with the last searched city forecast -->
  </body>
</html>